import*as t from"@wordpress/interactivity";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const o=(i={getContext:()=>t.getContext,store:()=>t.store,withScope:()=>t.withScope},s={},e.d(s,i),s),{apiFetch:n}=window.wp,{actions:c,callbacks:a,state:r}=(0,o.store)("activitypub/reactions",{actions:{async fetchReactions(){const t=(0,o.getContext)(),{namespace:e}=r;if(t.postId)try{t.reactions=await n({path:`/${e}/posts/${t.postId}/reactions`})}catch(t){console.error("Error fetching reactions:",t)}},openModal({target:t}){const e=(0,o.getContext)(),n=t.closest("[data-reaction-type]").getAttribute("data-reaction-type");e.isModalOpen=!0,e.modal.items=r.reactions[e.postId][n].items,setTimeout(a.positionModal,0)},closeModal(){const t=(0,o.getContext)();t.isModalOpen=!1;const e=document.getElementById(t.blockId);if(e){const t=e.querySelector(".reaction-label");t&&t.focus()}},toggleModal(t){const{isModalOpen:e}=(0,o.getContext)();e?c.closeModal():c.openModal(t)}},callbacks:{calculateVisibleAvatars(){const{blockId:t,postId:e}=(0,o.getContext)();(r.reactions&&r.reactions[e]?Object.keys(r.reactions[e]):[]).forEach((o=>{r.reactions?.[e][o]?.items?.length&&document.getElementById(t).querySelectorAll(".reaction-group").forEach((t=>{const n=t.querySelector(".reaction-label").offsetWidth||0,c=t.offsetWidth-n-12;let a=1;c>32&&(a+=Math.floor((c-32)/22));const i=r.reactions[e][o].items,s=Math.min(a,i.length),l=t.querySelector(".reaction-avatars");l&&l.querySelectorAll("li").forEach(((t,e)=>{e<s?t.removeAttribute("hidden"):t.setAttribute("hidden","hidden")}))}))}))},initReactions(){setTimeout((0,o.withScope)((()=>{const{blockId:t}=(0,o.getContext)(),e=new ResizeObserver((0,o.withScope)(a.calculateVisibleAvatars)),n=document.getElementById(t);n&&n.querySelectorAll(".reaction-group").forEach((t=>{e.observe(t)}))})),10)},setDefaultAvatar(t){t.target.src=r.defaultAvatarUrl},documentKeydown({key:t}){const{isModalOpen:e}=(0,o.getContext)();e&&"Escape"===t&&c.closeModal()},documentClick(t){const{blockId:e,isModalOpen:n}=(0,o.getContext)();if(!n)return;const a=document.getElementById(e);if(!a)return;const r=a.querySelector('.wp-element-button[data-wp-on--click="actions.toggleModal"]');if(r&&(r===t.target||r.contains(t.target)))return;const i=a.querySelector(".activitypub-modal__frame");i&&!i.contains(t.target)&&c.closeModal()},positionModal(){const{blockId:t}=(0,o.getContext)(),e=document.getElementById(t);if(!e)return;const n=e.querySelector(".reaction-label");if(!n)return;const c=e.querySelector(".activitypub-modal__overlay");if(!c)return;c.style.top="",c.style.left="",c.style.right="",c.style.bottom="";const a=n.getBoundingClientRect(),r=window.innerWidth,i=e.getBoundingClientRect();let s={top:a.bottom-i.top+8+"px",left:a.left-i.left-2+"px"};r-a.right<250&&(s.left="auto",s.right=i.right-a.right+"px"),Object.assign(c.style,s)}}});var i,s;