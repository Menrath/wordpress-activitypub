(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.element,n=window.wp.domReady;var a=e.n(n);const l=window.wp.components,c=window.wp.apiFetch;var o=e.n(c);function s(){return window._activityPubOptions||{}}window.wp.i18n;const i=({reactions:e})=>{const{defaultAvatarUrl:r}=s();return(0,t.createElement)("ul",{className:"reaction-avatars"},e.map(((e,n)=>{const a=["reaction-avatar"].filter(Boolean).join(" "),l=e.avatar||r;return(0,t.createElement)("li",{key:n},(0,t.createElement)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer"},(0,t.createElement)("img",{src:l,alt:e.name,className:a,width:"32",height:"32",onError:e=>{e.target.src=r}})))})))},u=({reactions:e,type:r})=>{const{defaultAvatarUrl:n}=s();return(0,t.createElement)("ul",{className:"activitypub-reaction-list"},e.map(((e,r)=>{const a=e.avatar||n;return(0,t.createElement)("li",{key:r},(0,t.createElement)("a",{href:e.url,className:"reaction-item",target:"_blank",rel:"noopener noreferrer"},(0,t.createElement)("img",{src:a,alt:e.name,width:"32",height:"32",onError:e=>{e.target.src=n}}),(0,t.createElement)("span",null,e.name)))})))},m=({items:e,label:n})=>{const[a,c]=(0,r.useState)(!1),[o,s]=(0,r.useState)(null),[m,d]=(0,r.useState)(e.length),p=(0,r.useRef)(null);(0,r.useEffect)((()=>{if(!p.current)return;const t=()=>{const t=p.current;if(!t)return;const r=t.offsetWidth-(o?.offsetWidth||0)-12,n=Math.max(1,Math.floor((r-32)/22));d(Math.min(n,e.length))};t();const r=new ResizeObserver(t);return r.observe(p.current),()=>{r.disconnect()}}),[o,e.length]);const f=e.slice(0,m);return(0,t.createElement)("div",{className:"reaction-group",ref:p},(0,t.createElement)(i,{reactions:f}),(0,t.createElement)(l.Button,{ref:s,className:"reaction-label is-link",onClick:()=>c(!a),"aria-expanded":a},n),a&&o&&(0,t.createElement)(l.Popover,{anchor:o,onClose:()=>c(!1)},(0,t.createElement)(u,{reactions:e})))};function d({postId:e=null,reactions:n=null}){const{namespace:a}=s(),[l,c]=(0,r.useState)(n),[i,u]=(0,r.useState)(!n);return(0,r.useEffect)((()=>{if(n)return c(n),void u(!1);e?(u(!0),o()({path:`/${a}/posts/${e}/reactions`}).then((e=>{c(e),u(!1)})).catch((()=>u(!1)))):u(!1)}),[e,n]),i?null:l&&Object.values(l).some((e=>e.items?.length>0))?(0,t.createElement)(t.Fragment,null,Object.entries(l).map((([e,r])=>r.items?.length?(0,t.createElement)(m,{key:e,items:r.items,label:r.label}):null))):null}a()((()=>{[].forEach.call(document.querySelectorAll(".activitypub-reactions-block"),(e=>{const n=JSON.parse(e.dataset.attrs||e.parentElement.dataset.attrs);(0,r.createRoot)(e).render((0,t.createElement)(d,{...n}))}))}))})();